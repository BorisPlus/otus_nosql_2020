# CAP теорема

Домашнее задание
Цель: В результате выполнения ДЗ вы научитесь работать с гитом.
Необходимо написать к каким системам по CAP теореме относятся перечисленные БД и почему:
mongoDB, MSSQL, Kassandra.

ДЗ сдается ссылкой на гит, где расположен миниотчет в маркдауне.
Критерии оценки: Критерии оценки:
- задание выполнено - 5 баллов
- предложено красивое решение - плюс 1 балл
- предложено рабочее решение, но не устранены недостатки, указанные преподавателем - минус 1 балл
Рекомендуем сдать до: 09.10.2020


## Описание

CAP - это свойства ([1](https://ru.wikipedia.org/wiki/Теорема_CAP)):
* __согласованность__ (англ. _consistency_) данных — во всех вычислительных узлах в один момент времени данные не противоречат друг другу;
* __доступность__ (англ. _availability_) данных  — любой запрос к распределённой системе завершается корректным откликом, однако без гарантии, что ответы всех узлов системы совпадают;
* __устойчивость к разделению__ (англ. _partition tolerance_) данных — расщепление распределённой системы на несколько изолированных секций не приводит к некорректности отклика от каждой из секций.


## Если коротко


+/- | MongoDB | MSSQL | Kassandra
------------ | -------------| -------------| -------------
__согласованность данных__ | + | + | -
__доступность__ | - | + | +
__устойчивость к разделению__ | + | - | + | 


## Если подробно

### MongoDB

Мы только начали изучать это решение и я нашел отличное философское рассуждение о месте MongoDB в CAP-треугольнике [\*](https://stackoverflow.com/a/44440201) 

Пожтому отвечу по наитию
- (почему __C__) исходя из документации высокая согласованность достигается с помощью механизма "multi-document" транзакций [\*](https://www.mongodb.com/blog/post/multi-document-transactions). 

_Мое примечание_: мне кажется вообще, где есть слово "транзакция", то это уже говорит о способности данных быть "согласованными".

- (почему __P__) я так понял, что при физическом разделении серверов с базами данных "клонов" на независимые сегменты, есть вожмосность автоматического перехода базы данных из Slave в режим Мастера для этого сегмента.  

- (почему не __A__) я так понял, что запрос согласованных, но распределяемых по нескольким узлам хранения данных, приводит к тому, что таймаут выдачи действительно актуальных сведений клиенту MongoDB возрастает.


Следующие пункты относятся к абстрактной распределенной БД MongoDB.

MongoDB обеспечивает strong consistency, потому что это система с одним Master узлом, и все записи идут по умолчанию в него.
Автоматическая смена мастера, в случае отделения его от остальных узлов.
В случае разделения сети, система прекратит принимать записи до тех пор, пока не убедится, что может безопасно завершить их.

Таким образом, система может продолжать работу в случае разделения сети, но теряется CAP-availability всех узлов. Это CP система!


### Microsoft SQL

- (почему __C__) можно добиться  согласованносит даннных настроив доставку журналов транзакции на реплики или механизм "зеркального отображения базы данных" [2](https://docs.microsoft.com/ru-ru/sql/database-engine/database-mirroring/database-mirroring-sql-server?view=sql-server-ver15).

```text
В сценарии зеркального отражения базы данных каждое изменение в базе данных (основной базе данных) 
немедленно воспроизводится в ее полной автономной копии (зеркальной базе данных). 
Экземпляр основного сервера немедленно отсылает каждую запись журнала в экземпляр зеркального сервера, 
который применяет входящие записи к зеркальной базе данных, путем ее непрерывного наката. 
```

Что удивительно, исходя из описания

```text
Зеркальное отображение базы данных — это решение, нацеленное на повышение доступности базы данных SQL Server. 
Зеркальное отображение каждой базы данных осуществляется отдельно и работает только с теми базами данных, 
которые используют модель полного восстановления.
```

оно ("зеркальное отображение базы данных") нацелено не на согласованность, а на доступность, и указывается, что 

```text
В будущей версии Microsoft SQL Server этот компонент будет удален. Избегайте использования этого компонента 
в новых разработках и запланируйте изменение существующих приложений, в которых он применяется. 
Вместо этого используйте Группы доступности AlwaysOn.
```

- (почему __A__) как описано выше, к высокой доступности MSSQL стремятся за счет использования "зеркального отображения базы данных"[2](https://docs.microsoft.com/ru-ru/sql/database-engine/database-mirroring/database-mirroring-sql-server?view=sql-server-ver15) или "группы доступности AlwaysOn"[3](https://docs.microsoft.com/ru-ru/sql/database-engine/availability-groups/windows/overview-of-always-on-availability-groups-sql-server?view=sql-server-ver15) [4](https://docs.microsoft.com/ru-ru/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server?view=sql-server-ver15). 

Необходимо заметить, что доступность узла MSSQL обычно обеспечивается не только какими-то внутренними механизмами, но и возможностью использовния специальных кластерных служб Microsoft Server и определенной аппаратной инфраструктуры. Так, например, база данных может работать на кластерной службе Microsoft Server и использовать отдельную дисковую корзину нескольких физических серверов (да, еще там диск кворума и сетевая служба), при этом MSSQL имеет свой IP-адрес, отдельный от этих ЭВМ. И если выключить основную ноду, то сервис перейдет на резервную ноду кластера, а при восстановлении первой вернется на нее (тут на самом деле большая _боль_ "внедряльщика", который бы эфимерный абсолют __A__ даже при  абсолютной надежности сети отверг как практик).  

- (почему не __P__) расщепление распределённой системы на несколько изолированных секций __приводит__ к некорректности отклика от секций. Если связь в системе стала нестабильной, то это приведет как к потере согласованности (Мастер не отправит реплику на слейв). Если загружать данные на разные сервера, например, все, а не при шардировании, это тоже повлияет на вогласованность.


### Kassandra

- (почему __C__)
- (почему __A__)
- (почему __P__)



(https://docs.microsoft.com/ru-ru/sql/relational-databases/logs/the-transaction-log-sql-server?view=sql-server-ver15)
