# Redis

Домашнее задание. Необходимо:
- сохранить большой жсон (~20МБ) в виде разных структур:
    - строка 
    - сложная структура из hset, zset, list
- протестировать скорость сохранения и чтения
- предоставить отчет

* настроить редис кластер на 3х нодах с отказоусточивостью, затюнить таймоуты
Критерии оценки: Критерии оценки:
- задание выполнено - 5 баллов
- предложено красивое решение - плюс 1 балл
- предложено рабочее решение, но не устранены недостатки, указанные преподавателем - минус 1 балл
Рекомендуем сдать до: 27.11.2020

## Json Data

__Ремарка__: cложно найти действительно хороший Json для задачи. 
Чтобы честно замерить время вставки данных, Json-набор не должен предполагать проведение с ним манипуляций и преобразований.
Можно было бы провести конвертирование выбранного мной набора в тот вид Json, который потребовал бы
непосредственно только вставки данных в БД, без предварительных изменений значений полей. Но я не стал. (Могу сделать, если надо).
Для пояснения этой мысти в скриптах вставки данных я указал на те места, в которых процессорное время отнимается самим скриптом, 
так как имеется то или иное преобразование, что я и отметил фразой в коде скриптов "# Внимание: тут тратится время на ...".
Какой-либо вывод на экран во время вставки данных отключен, чтоб на это не тратилось замеряемое "время".

__Вопрос__: В рамках данного исследования можно пренебречь вышеописанным или все же преобразовать в "хороший" для чистого эксперимента по вставке Json?

[Реестр муниципальных маршрутов регулярных перевозок пассажиров и багажа автомобильным и наземным электрическим транспортом в городе Москве](https://data.gov.ru/opendata/7704786030-municipalroutesregister)
 и [json-данные ~ 60 МБ](https://data.gov.ru/sites/default/files/opendata/7704786030-MunicipalRoutesRegister/data-2017-07-18T00-00-00-structure-2017-07-18T00-00-00.json)
 ([зеркало в текущем репозитории](011.files/data.json))

Структура:
 - "system_object_id":("STRING"),
 - "CarrierName" ("STRING", Наименование юридического лица или индивидуального предпринимателя, осуществляющего перевозки пассажиров по маршруту"),
 - "global_id" ("NUMBER"),
 - "RouteNumber" ("STRING", "Номер маршрута"),
 - "DirectRouteTrack" ("STRING", "Координаты прямого трека маршрута"),
 - "ReverseTrackOfFollowing" ("STRING", "Трасса следования маршрута (обратное направление)"),
 - "is_deleted" ("NUMBER"),
 - "signature_date" ("STRING"),
 - "ReverseRouteTrack" ("STRING", "Координаты обратного трека маршрута"),
 - "TrackOfFollowing" ("STRING", "Трасса следования маршрута (прямое направление)"),
 - "RouteName" ("STRING", "Наименование маршрута"),
 - "ID" ("INTEGER", "Код"),
 - "TypeOfTransport" ("DICTIONARY", "Вид транспорта").
 
## Поставить зависимости

```bash
pip3 install -r ./011.files/req.txt 
```

## Время на вставку даннных

Как строка

[Cкрипт загрузки JSON как строки](011.files/upload_as_string.py)

Запустил для первых 251 записи JSON-набора.
```bash
python3 upload_as_string.py

Upload json as true-string.
         Were upload: 251 units
         Time left: 239.38326907157898 ms
```

Как сложная структура из hset, zset, list

[Cкрипт загрузки JSON как сложной структуры](011.files/upload_as_structure.py)

Запустил для первых 251 записи JSON-набора.

```bash
python3 upload_as_structure.py

Upload json as complex structure.
         hset - https://redis.io/commands/hset
         zadd - https://redis.io/commands/zadd
         list - https://redis.io/commands/lpush
         Were upload: 251 units
         Time left: 232.33045530319214 ms

```

Видим, что на первых 251 данные как строки вставляются медленнее, чем как "распознанных" данных как структуры.


## Время на выборку

[Какие ключи у строк](011.files/load_string_keys.py)

```bash
python3 load_string_keys.py
```
<details>
<summary>Load strings.</summary>
b'data:15'
b'data:124'
b'data:18'
b'data:86'
b'data:150'
b'data:181'
b'data:41'
b'data:173'
b'data:23'
b'data:141'
b'data:220'
b'data:56'
b'data:26'
b'data:17'
b'data:51'
b'data:167'
b'data:144'
b'data:143'
b'data:107'
b'data:146'
b'data:32'
b'data:207'
b'data:214'
b'data:12'
b'data:152'
b'data:4'

</details>